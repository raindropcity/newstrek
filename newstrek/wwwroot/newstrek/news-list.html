<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>NewsTrek</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/news-list.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
        integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital@1&display=swap" rel="stylesheet">
</head>

<body class="main-content">
    <header class="section sec1 header active" id="news">
        <div class="header-content" id="news-header-content">
            <div class="left-header" id="news-header">
                <div class="vocabulary show-up" id="news-content">
                    <div class="blog">
                        <div class="blog-text">

                        </div>
                    </div>
                </div>
            </div>
    </header>

    <!-- 右側fixed button -->
    <div class="controlls">
        <a href="/newstrek/home.html" class="control control-1 active-btn" data-id="home">
            <i class="fas fa-home"></i>
        </a>
        <a href="/newstrek/category.html" class="control control-4 active-btn" data-id="blogs">
            <i class="far fa-newspaper"></i>
        </a>
        <a href="#" class="control control-3 active-btn" data-id="portfolio">
            <i class="fas fa-briefcase"></i>
        </a>
        <a href="#" class="control control-2 active-btn" data-id="about">
            <i class="fas fa-user"></i>
        </a>
        <a href="#" class="control control-5 active-btn" data-id="contact">
            <i class="fas fa-envelope-open"></i>
        </a>
    </div>

    <!-- 引用JS -->
    <script src="../js/action.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            // Get the query string
            const queryString = window.location.search;
            // Create a URLSearchParams object to handle the query string
            const params = new URLSearchParams(queryString);
            // Get the value of the "category" or "keyword" parameter
            const category = params.get("category");
            const keyword = params.get("keyword");

            const container = document.querySelector(".blog-text")

            if (category) {
                $.ajax({
                    url: `/ElasticSearch/search-news-by-category?category=${category}`,
                    method: 'GET',
                    success: function (response) {
                        $.each(response, function (index, value) {
                            const url = value.url;
                            const pattern = /\/(\d+)\//; // Regular expression pattern to match the number within slashes

                            const match = url.match(pattern);
                            let number = 0

                            if (match && match.length > 1) {
                                number = match[1];
                                console.log("Extracted Number:", number);
                            } else {
                                console.log("Number not found in URL.");
                            }
                            
                            container.innerHTML += `
                                <div>
                                    <span>${index + 1}</span>
                                    <a href="/newstrek/news.html?num=${number}">${value.title}</a>
                                </div>
                            `
                        })
                        console.log(response)
                    },
                    error: function (error) {
                        console.error('error in GET request to search news by category', error)
                    }
                })
            }

            if (keyword) {
                $.ajax({
                    url: `/ElasticSearch/SearchNews?keyword=${keyword}`,
                    method: 'GET',
                    success: function (response) {
                        console.log(response)
                        $.each(response, function (index, value) {
                            const url = value.url;
                            const pattern = /\/(\d+)\//; // Regular expression pattern to match the number within slashes

                            const match = url.match(pattern);
                            let number = 0

                            if (match && match.length > 1) {
                                number = match[1];
                                console.log("Extracted Number:", number);
                            } else {
                                console.log("Number not found in URL.");
                            }

                            container.innerHTML += (`
                                <div>
                                    <span>${index + 1}</span>
                                    <a href="/newstrek/news.html?num=${number}">${value.title}</a>
                                </div>
                            `)
                        })
                    },
                    error: function (error) {
                        console.error('error in GET request to search news', error)
                    }
                })
            }
        })
    </script>
</body>

</html>